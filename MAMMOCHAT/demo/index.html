<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MammoChat</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #ffffff;
            --bg-chat: #fdf2f8;
            --text: #1a1a1a;
            --text-secondary: #6b6b6b;
            --border: #fce7f3;
            --pink: #ec4899;
            --pink-dark: #db2777;
            --pink-light: #fdf2f8;
            --pink-pale: #fce7f3;
            --green: #10b981;
            --amber: #f59e0b;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg);
            color: var(--text);
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        header {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--bg);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--pink), #f472b6);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .logo-text {
            font-weight: 600;
            font-size: 16px;
        }

        .context {
            display: flex;
            gap: 8px;
        }

        .context select {
            background: var(--bg-chat);
            border: 1px solid var(--border);
            padding: 6px 10px;
            border-radius: 8px;
            font-size: 12px;
            font-family: inherit;
            color: var(--text);
            cursor: pointer;
        }

        .context select:focus {
            outline: none;
            border-color: var(--pink);
        }

        /* Messages */
        main {
            flex: 1;
            overflow-y: auto;
            background: var(--bg);
        }

        .messages {
            max-width: 720px;
            margin: 0 auto;
            padding: 24px 16px;
        }

        .message {
            margin-bottom: 24px;
        }

        .message-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 8px;
        }

        .avatar {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
        }

        .avatar.user {
            background: var(--pink);
            color: white;
        }

        .avatar.assistant {
            background: linear-gradient(135deg, var(--pink), #f472b6);
            color: white;
        }

        .message-role {
            font-weight: 600;
            font-size: 14px;
        }

        .message-content {
            padding-left: 40px;
            font-size: 15px;
            line-height: 1.6;
            color: var(--text);
        }

        .evidence-box {
            margin-top: 12px;
            padding: 12px 16px;
            background: var(--pink-light);
            border-radius: 8px;
            border-left: 3px solid var(--pink);
        }

        .evidence-label {
            font-size: 11px;
            font-weight: 600;
            color: var(--pink);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 6px;
        }

        .evidence-item {
            font-size: 12px;
            color: var(--text-secondary);
            font-family: 'SF Mono', Monaco, monospace;
        }

        .mcode-box {
            margin-top: 8px;
            padding: 8px 12px;
            background: var(--bg-chat);
            border-radius: 6px;
            font-size: 11px;
            font-family: 'SF Mono', Monaco, monospace;
            color: var(--text-secondary);
        }

        /* Welcome */
        .welcome {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            text-align: center;
            padding: 48px 24px;
        }

        .welcome-icon {
            width: 64px;
            height: 64px;
            background: linear-gradient(135deg, var(--pink), #f472b6);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            margin-bottom: 24px;
        }

        .welcome h1 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .welcome p {
            color: var(--text-secondary);
            font-size: 14px;
            max-width: 360px;
            margin-bottom: 24px;
        }

        .suggestions {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
            max-width: 400px;
        }

        .suggestion {
            background: var(--bg-chat);
            border: 1px solid var(--border);
            padding: 10px 16px;
            border-radius: 12px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .suggestion:hover {
            background: var(--pink-light);
            border-color: var(--pink);
            color: var(--pink);
        }

        .disclaimer {
            margin-top: 32px;
            padding: 12px 16px;
            background: #fef3c7;
            border: 1px solid #fbbf24;
            border-radius: 8px;
            font-size: 11px;
            color: #92400e;
        }

        /* Input */
        .input-area {
            padding: 16px;
            border-top: 1px solid var(--border);
            background: var(--bg);
        }

        .input-container {
            max-width: 720px;
            margin: 0 auto;
            position: relative;
        }

        .input-box {
            width: 100%;
            padding: 14px 52px 14px 16px;
            background: var(--bg-chat);
            border: 1px solid var(--border);
            border-radius: 12px;
            font-size: 14px;
            font-family: inherit;
            resize: none;
            line-height: 1.5;
        }

        .input-box:focus {
            outline: none;
            border-color: var(--pink);
            box-shadow: 0 0 0 3px rgba(236, 72, 153, 0.15);
        }

        .send-btn {
            position: absolute;
            right: 8px;
            bottom: 8px;
            width: 36px;
            height: 36px;
            background: var(--pink);
            border: none;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }

        .send-btn:hover {
            background: var(--pink-dark);
        }

        .send-btn svg {
            width: 18px;
            height: 18px;
        }

        .input-hint {
            text-align: center;
            margin-top: 8px;
            font-size: 11px;
            color: var(--text-secondary);
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">
            <div class="logo-icon">ðŸ’—</div>
            <span class="logo-text">MammoChat</span>
        </div>
        <div class="context">
            <select id="histology" onchange="updateContext()">
                <option value="UNKNOWN">Histology</option>
                <option value="DCIS">DCIS</option>
                <option value="INVASIVE">Invasive</option>
            </select>
            <select id="phase" onchange="updateContext()">
                <option value="SCREENING">Screening</option>
                <option value="DIAGNOSIS">Diagnosis</option>
                <option value="TREATMENT">Treatment</option>
            </select>
        </div>
    </header>

    <main>
        <div class="messages" id="messages"></div>
    </main>

    <div class="input-area">
        <div class="input-container">
            <textarea
                class="input-box"
                id="input"
                rows="1"
                placeholder="Ask about breast imaging, screening, or treatment..."
                onkeydown="if(event.key==='Enter'&&!event.shiftKey){event.preventDefault();send()}"
            ></textarea>
            <button type="button" class="send-btn" onclick="send()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/>
                </svg>
            </button>
        </div>
        <div class="input-hint">MammoChat provides educational information only. Not medical advice.</div>
    </div>

    <script>
        const MCODE = {
            DCIS: { snomed: '109886000', desc: 'Ductal carcinoma in situ' },
            INVASIVE: { snomed: '254837009', desc: 'Invasive breast carcinoma' },
            UNKNOWN: { snomed: '?', desc: 'Histology pending' }
        };

        let ctx = { histology: 'UNKNOWN', phase: 'SCREENING' };
        let messages = [];

        function updateContext() {
            ctx.histology = document.getElementById('histology').value;
            ctx.phase = document.getElementById('phase').value;
        }

        function render() {
            const el = document.getElementById('messages');

            if (!messages.length) {
                el.innerHTML = `
                    <div class="welcome">
                        <div class="welcome-icon">ðŸ’—</div>
                        <h1>MammoChat</h1>
                        <p>Evidence-based breast health information with BI-RADS and NCCN guideline integration.</p>
                        <div class="suggestions">
                            <div class="suggestion" onclick="askQuestion('What is BI-RADS?')">What is BI-RADS?</div>
                            <div class="suggestion" onclick="askQuestion('DCIS treatment options')">DCIS treatment</div>
                            <div class="suggestion" onclick="askQuestion('When is chemotherapy needed?')">Chemotherapy</div>
                        </div>
                        <div class="disclaimer">
                            <strong>Not medical advice</strong> â€” For educational purposes only. Consult your healthcare provider.
                        </div>
                    </div>
                `;
                return;
            }

            el.innerHTML = messages.map(m => {
                const evidence = m.evidence?.length ? `
                    <div class="evidence-box">
                        <div class="evidence-label">Evidence</div>
                        ${m.evidence.map(e => `<div class="evidence-item">${e}</div>`).join('')}
                    </div>
                ` : '';

                const mcode = m.mcode ? `
                    <div class="mcode-box">mCODE: ${m.mcode.snomed} | ${m.mcode.phase}</div>
                ` : '';

                return `
                    <div class="message">
                        <div class="message-header">
                            <div class="avatar ${m.role}">${m.role === 'user' ? 'U' : 'M'}</div>
                            <span class="message-role">${m.role === 'user' ? 'You' : 'MammoChat'}</span>
                        </div>
                        <div class="message-content">
                            ${m.content}
                            ${evidence}
                            ${mcode}
                        </div>
                    </div>
                `;
            }).join('');

            el.scrollTop = el.scrollHeight;
        }

        function respond(text) {
            const t = text.toLowerCase();
            const h = ctx.histology;
            const mc = { snomed: MCODE[h].snomed, phase: ctx.phase };

            if (t.includes('birads') || t.includes('bi-rads')) {
                return {
                    content: `<strong>BI-RADS Categories:</strong><br><br>
                        <strong>0</strong> â€” Incomplete, need additional imaging<br>
                        <strong>1</strong> â€” Negative, routine screening<br>
                        <strong>2</strong> â€” Benign finding<br>
                        <strong>3</strong> â€” Probably benign (<2% malignancy)<br>
                        <strong>4</strong> â€” Suspicious (2-95% malignancy)<br>
                        <strong>5</strong> â€” Highly suggestive (>95% malignancy)<br>
                        <strong>6</strong> â€” Known biopsy-proven malignancy`,
                    evidence: ['ACR BI-RADS Atlas 5th Edition', 'NCCN.Breast.2024'],
                    mcode: mc
                };
            }

            if (t.includes('chemo') && h === 'DCIS') {
                return {
                    content: `<strong>DCIS does not require chemotherapy.</strong><br><br>
                        DCIS (Ductal Carcinoma In Situ) is non-invasive. Standard treatment includes surgery (lumpectomy or mastectomy) Â± radiation therapy. Endocrine therapy may be recommended for hormone receptor-positive DCIS.`,
                    evidence: ['NCCN.Breast.2024.DCIS-1', 'SNOMED:109886000'],
                    mcode: mc
                };
            }

            if (t.includes('chemo') && h === 'INVASIVE') {
                return {
                    content: `<strong>Chemotherapy may be indicated for invasive breast cancer.</strong><br><br>
                        Recommendations depend on tumor size, grade, lymph node status, and receptor status (ER, PR, HER2). Genomic testing (Oncotype DX, MammaPrint) can help determine benefit.`,
                    evidence: ['NCCN.Breast.2024.INV-1', 'SNOMED:254837009'],
                    mcode: mc
                };
            }

            if (t.includes('chemo')) {
                return {
                    content: `<strong>Chemotherapy recommendations require histology.</strong><br><br>
                        Please select a histology type (DCIS or Invasive) to receive specific guidance. DCIS typically does not require chemotherapy, while invasive cancer may.`,
                    evidence: ['NCCN.Breast.2024'],
                    mcode: mc
                };
            }

            if (t.includes('dcis') || t.includes('treatment')) {
                if (h === 'DCIS') {
                    return {
                        content: `<strong>DCIS Treatment Options:</strong><br><br>
                            â€¢ <strong>Lumpectomy + Radiation</strong> â€” breast-conserving approach<br>
                            â€¢ <strong>Mastectomy</strong> â€” may be chosen for large or multicentric DCIS<br>
                            â€¢ <strong>Endocrine therapy</strong> â€” for ER-positive DCIS to reduce recurrence<br><br>
                            Chemotherapy is NOT indicated for DCIS.`,
                        evidence: ['NCCN.Breast.2024.DCIS-2', 'SNOMED:109886000'],
                        mcode: mc
                    };
                }
                return {
                    content: `<strong>DCIS (Ductal Carcinoma In Situ)</strong><br><br>
                        DCIS is a non-invasive condition where abnormal cells are found in the milk duct lining. It's considered Stage 0 breast cancer. Select "DCIS" in histology for specific treatment guidance.`,
                    evidence: ['NCCN.Breast.2024', 'SNOMED:109886000'],
                    mcode: mc
                };
            }

            if (t.includes('screening') || t.includes('mammogram')) {
                return {
                    content: `<strong>Breast Cancer Screening Guidelines:</strong><br><br>
                        â€¢ <strong>Average risk:</strong> Annual mammogram starting at age 40<br>
                        â€¢ <strong>High risk:</strong> Annual MRI + mammogram, starting earlier<br>
                        â€¢ <strong>Very high risk:</strong> Consider risk-reducing options<br><br>
                        Risk assessment tools: Tyrer-Cuzick, Gail Model`,
                    evidence: ['NCCN.Breast.Screening.2024', 'ACS Guidelines 2024'],
                    mcode: mc
                };
            }

            return {
                content: `I understand you're asking about "${text}". For specific guidance, try asking about:<br><br>
                    â€¢ BI-RADS categories<br>
                    â€¢ DCIS treatment<br>
                    â€¢ Chemotherapy indications<br>
                    â€¢ Screening guidelines`,
                evidence: ['MammoChat.v1'],
                mcode: mc
            };
        }

        function askQuestion(q) {
            document.getElementById('input').value = q;
            send();
        }

        function send() {
            const input = document.getElementById('input');
            const text = input.value.trim();
            if (!text) return;

            const mc = { snomed: MCODE[ctx.histology].snomed, phase: ctx.phase };
            messages.push({ role: 'user', content: text, mcode: mc });
            messages.push({ role: 'assistant', ...respond(text) });

            input.value = '';
            render();
        }

        render();
    </script>
</body>
</html>
